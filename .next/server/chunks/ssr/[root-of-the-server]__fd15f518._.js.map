{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/actions/templates.ts"],"sourcesContent":["'use server'\n\nimport { prisma } from '@/lib/prisma'\nimport { revalidatePath } from 'next/cache'\nimport { getCurrentUser, isPlatformAdmin } from '@/lib/auth'\nimport { TemplateStatus } from '@prisma/client'\n\nexport async function getAllTemplates() {\n  try {\n    const templates = await prisma.diagnosticTemplate.findMany({\n      include: {\n        sections: {\n          include: {\n            questions: {\n              where: { active: true },\n              orderBy: { createdAt: 'asc' }\n            }\n          },\n          orderBy: { order: 'asc' }\n        },\n        _count: {\n          select: {\n            sections: true,\n            assessments: true\n          }\n        }\n      },\n      orderBy: { createdAt: 'desc' }\n    })\n\n    return { success: true, templates }\n  } catch (error) {\n    console.error('Erro ao buscar templates:', error)\n    return { error: 'Erro ao buscar templates' }\n  }\n}\n\nexport async function getTemplateById(templateId: string) {\n  try {\n    const template = await prisma.diagnosticTemplate.findUnique({\n      where: { id: templateId },\n      include: {\n        sections: {\n          include: {\n            questions: {\n              where: { active: true },\n              orderBy: { createdAt: 'asc' }\n            }\n          },\n          orderBy: { order: 'asc' }\n        },\n        _count: {\n          select: { assessments: true }\n        }\n      }\n    })\n\n    if (!template) {\n      return { error: 'Template não encontrado' }\n    }\n\n    return { success: true, template }\n  } catch (error) {\n    console.error('Erro ao buscar template:', error)\n    return { error: 'Erro ao buscar template' }\n  }\n}\n\nexport async function updateTemplateStatus(templateId: string, status: TemplateStatus) {\n  const user = await getCurrentUser()\n  if (!user) {\n    return { error: 'Não autorizado' }\n  }\n\n  const isAdmin = await isPlatformAdmin(user.id)\n  if (!isAdmin) {\n    return { error: 'Apenas administradores podem alterar o status de templates' }\n  }\n\n  try {\n    await prisma.diagnosticTemplate.update({\n      where: { id: templateId },\n      data: { status }\n    })\n\n    revalidatePath('/dashboard/templates')\n    return { success: true }\n  } catch (error) {\n    console.error('Erro ao atualizar status do template:', error)\n    return { error: 'Erro ao atualizar status do template' }\n  }\n}\n\nexport async function deleteTemplate(templateId: string) {\n  const user = await getCurrentUser()\n  if (!user) {\n    return { error: 'Não autorizado' }\n  }\n\n  const isAdmin = await isPlatformAdmin(user.id)\n  if (!isAdmin) {\n    return { error: 'Apenas administradores podem excluir templates' }\n  }\n\n  try {\n    // Verificar se há assessments usando este template\n    const assessmentCount = await prisma.assessment.count({\n      where: { templateId }\n    })\n\n    if (assessmentCount > 0) {\n      return { error: `Não é possível excluir. Existem ${assessmentCount} diagnósticos usando este template.` }\n    }\n\n    await prisma.diagnosticTemplate.delete({\n      where: { id: templateId }\n    })\n\n    revalidatePath('/dashboard/templates')\n    return { success: true }\n  } catch (error) {\n    console.error('Erro ao excluir template:', error)\n    return { error: 'Erro ao excluir template' }\n  }\n}\n\nexport async function getPublishedTemplates() {\n  try {\n    const templates = await prisma.diagnosticTemplate.findMany({\n      where: { status: 'PUBLISHED' },\n      select: {\n        id: true,\n        name: true,\n        description: true,\n        type: true,\n        _count: {\n          select: { sections: true }\n        }\n      },\n      orderBy: { name: 'asc' }\n    })\n\n    return { success: true, templates }\n  } catch (error) {\n    console.error('Erro ao buscar templates publicados:', error)\n    return { error: 'Erro ao buscar templates publicados' }\n  }\n}\n\nexport async function applyTemplateToAssessment(assessmentId: string, templateId: string) {\n  const user = await getCurrentUser()\n  if (!user) {\n    return { error: 'Não autorizado' }\n  }\n\n  try {\n    // Verificar se o assessment existe e se o usuário tem permissão\n    const assessment = await prisma.assessment.findUnique({\n      where: { id: assessmentId },\n      select: { companyId: true, status: true, templateId: true }\n    })\n\n    if (!assessment) {\n      return { error: 'Diagnóstico não encontrado' }\n    }\n\n    if (assessment.status !== 'DRAFT') {\n      return { error: 'Só é possível aplicar template em diagnósticos com status DRAFT' }\n    }\n\n    if (assessment.templateId) {\n      return { error: 'Este diagnóstico já possui um template associado' }\n    }\n\n    const isAdmin = await isPlatformAdmin(user.id)\n    const membership = await prisma.membership.findFirst({\n      where: {\n        userId: user.id,\n        companyId: assessment.companyId,\n        status: 'ACTIVE'\n      }\n    })\n\n    if (!isAdmin && !membership) {\n      return { error: 'Sem permissão para modificar este diagnóstico' }\n    }\n\n    // Buscar o template com seções e perguntas para validação\n    const template = await prisma.diagnosticTemplate.findUnique({\n      where: { id: templateId },\n      include: {\n        sections: {\n          include: {\n            questions: {\n              where: { active: true }\n            }\n          }\n        }\n      }\n    })\n\n    if (!template) {\n      return { error: 'Template não encontrado' }\n    }\n\n    if (template.status !== 'PUBLISHED') {\n      return { error: 'Apenas templates publicados podem ser aplicados' }\n    }\n\n    // Associar o template ao assessment\n    // As seções e perguntas já existem no template e serão acessadas via relacionamento\n    await prisma.assessment.update({\n      where: { id: assessmentId },\n      data: { templateId }\n    })\n\n    revalidatePath(`/dashboard/diagnostics/${assessmentId}`)\n    return { \n      success: true, \n      sectionsCount: template.sections.length,\n      questionsCount: template.sections.reduce((sum, s) => sum + s.questions.length, 0)\n    }\n  } catch (error) {\n    console.error('Erro ao aplicar template:', error)\n    return { error: 'Erro ao aplicar template ao diagnóstico' }\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 335, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/.next-internal/server/app/dashboard/templates/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {logout as '00e33b1bc9c45bf4436859b6bedf448b663371b550'} from 'ACTIONS_MODULE0'\nexport {signup as '404250705a23c134c12043456dc104a8397d20743f'} from 'ACTIONS_MODULE0'\nexport {resetPassword as '406d97f2c42c1a800ea1701b2bf70d7c0f7a995304'} from 'ACTIONS_MODULE0'\nexport {updatePassword as '40905c4932dedb1bcb1ecdf003ad3b3119396f35aa'} from 'ACTIONS_MODULE0'\nexport {login as '40ab8619998d3b0276e7c6f5b73ce69f02528a6777'} from 'ACTIONS_MODULE0'\nexport {getPublishedTemplates as '007a550b8ab988479fadca47f07be583e91ab0ee6b'} from 'ACTIONS_MODULE1'\nexport {getAllTemplates as '007b8f3e08b2142581e58aed1908e134ddf9268b66'} from 'ACTIONS_MODULE1'\nexport {getTemplateById as '40175f25f00b18d8111ebc14c13a5de546ec6bbb64'} from 'ACTIONS_MODULE1'\nexport {deleteTemplate as '4061be19390dd76d2237136a8308c572a7876b0c9e'} from 'ACTIONS_MODULE1'\nexport {updateTemplateStatus as '608803ecbd5ec8fd5b412df9aa9aa3888aa8896445'} from 'ACTIONS_MODULE1'\nexport {applyTemplateToAssessment as '60ada3c002f1cfa29876e53c23dabfb53e390b7c74'} from 'ACTIONS_MODULE1'\n"],"names":[],"mappings":";AAAA;AAKA","debugId":null}},
    {"offset": {"line": 396, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/components/dashboard/template-list.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const TemplateList = registerClientReference(\n    function() { throw new Error(\"Attempted to call TemplateList() from the server but TemplateList is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/components/dashboard/template-list.tsx <module evaluation>\",\n    \"TemplateList\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;AACO,MAAM,eAAe,IAAA,wQAAuB,EAC/C;IAAa,MAAM,IAAI,MAAM;AAAwO,GACrQ,wEACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 410, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/components/dashboard/template-list.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const TemplateList = registerClientReference(\n    function() { throw new Error(\"Attempted to call TemplateList() from the server but TemplateList is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/components/dashboard/template-list.tsx\",\n    \"TemplateList\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;AACO,MAAM,eAAe,IAAA,wQAAuB,EAC/C;IAAa,MAAM,IAAI,MAAM;AAAwO,GACrQ,oDACA","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 424, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 432, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/app/dashboard/templates/page.tsx"],"sourcesContent":["import { Metadata } from 'next'\nimport { redirect } from 'next/navigation'\nimport { getCurrentUser } from '@/lib/auth'\nimport { getAllTemplates } from '@/app/actions/templates'\nimport { TemplateList } from '@/components/dashboard/template-list'\nimport { Button } from '@/components/ui/button'\nimport { Plus } from 'lucide-react'\nimport Link from 'next/link'\n\nexport const metadata: Metadata = {\n  title: 'Templates de Diagnóstico | i9HUBSST',\n  description: 'Gerencie templates de diagnóstico reutilizáveis',\n}\n\nexport default async function TemplatesPage() {\n  const user = await getCurrentUser()\n  if (!user) {\n    redirect('/login')\n  }\n\n  const result = await getAllTemplates()\n  \n  if ('error' in result) {\n    return (\n      <div className=\"container mx-auto px-4 py-8\">\n        <div className=\"rounded-md bg-red-50 p-4 text-sm text-red-800\">\n          {result.error}\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"container mx-auto px-4 py-8\">\n      <div className=\"mb-6 flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-2xl font-bold text-gray-900\">Templates de Diagnóstico</h1>\n          <p className=\"text-sm text-gray-600 mt-1\">\n            Gerencie templates reutilizáveis para NR-12, NR-35, ISO 45001 e outros\n          </p>\n        </div>\n        <Button asChild className=\"bg-teal-600 hover:bg-teal-700\">\n          <Link href=\"/dashboard/templates/new\">\n            <Plus className=\"mr-2 h-4 w-4\" />\n            Novo Template (IA)\n          </Link>\n        </Button>\n      </div>\n\n      <TemplateList templates={result.templates} />\n    </div>\n  )\n}\n"],"names":[],"mappings":";;;;;;;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AAEO,MAAM,WAAqB;IAChC,OAAO;IACP,aAAa;AACf;AAEe,eAAe;IAC5B,MAAM,OAAO,MAAM,IAAA,6HAAc;IACjC,IAAI,CAAC,MAAM;QACT,IAAA,iMAAQ,EAAC;IACX;IAEA,MAAM,SAAS,MAAM,IAAA,8IAAe;IAEpC,IAAI,WAAW,QAAQ;QACrB,qBACE,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;gBAAI,WAAU;0BACZ,OAAO,KAAK;;;;;;;;;;;IAIrB;IAEA,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;;0CACC,8OAAC;gCAAG,WAAU;0CAAmC;;;;;;0CACjD,8OAAC;gCAAE,WAAU;0CAA6B;;;;;;;;;;;;kCAI5C,8OAAC,qIAAM;wBAAC,OAAO;wBAAC,WAAU;kCACxB,cAAA,8OAAC,uKAAI;4BAAC,MAAK;;8CACT,8OAAC,0MAAI;oCAAC,WAAU;;;;;;gCAAiB;;;;;;;;;;;;;;;;;;0BAMvC,8OAAC,4JAAY;gBAAC,WAAW,OAAO,SAAS;;;;;;;;;;;;AAG/C","debugId":null}}]
}